# 设备和模块的分类

Linux看待设备的方式区分了三种基本设备类型。每个模块通常实现其中一种类型，因此可以分为字符模块、块模块或网络模块。模块的这种分类并不是严格的；程序员可以选择在一个代码块中实现不同驱动程序的大型模块。然而，优秀的程序员通常为每个新功能创建一个不同的模块，因为分解是可扩展性和可扩展性的关键要素。

这三种类型是：

- **字符设备**：字符设备是可以作为字节流访问的设备（如文件）；字符驱动程序负责实现这种行为。这种驱动程序通常至少实现open、close、read和write系统调用。文本控制台（/dev/console）和串行端口（/dev/ttyS0等）是字符设备的例子，因为它们很好地体现了流抽象。字符设备通过文件系统节点访问，例如/dev/tty1和/dev/lp0。字符设备与常规文件之间的唯一相关区别是，你总是可以在常规文件中来回移动，而大多数字符设备只是数据通道，你只能顺序访问。然而，也存在看起来像数据区域的字符设备，你可以在其中来回移动；例如，这通常适用于帧抓取器，应用程序可以使用mmap或lseek访问整个获取的图像。

- **块设备**：像字符设备一样，块设备通过/dev目录中的文件系统节点访问。块设备是可以托管文件系统的设备（例如磁盘）。在大多数Unix系统中，块设备只能处理传输一个或多个完整块的I/O操作，这些块通常为512字节（或更大的2的幂次方字节）。Linux则允许应用程序像字符设备一样读写块设备——它允许一次传输任意数量的字节。因此，块设备和字符设备仅在数据在内核中的管理方式以及内核/驱动程序软件接口方面有所不同。像字符设备一样，每个块设备通过文件系统节点访问，它们之间的区别对用户是透明的。块驱动程序与内核的接口与字符驱动程序完全不同。

- **网络接口**：任何网络事务都是通过接口进行的，即能够与其他主机交换数据的设备。通常，接口是硬件设备，但也可能是纯软件设备，如环回接口。网络接口负责发送和接收数据包，由内核的网络子系统驱动，而不需要知道单个事务如何映射到实际传输的数据包。许多网络连接（尤其是使用TCP的连接）是面向流的，但网络设备通常围绕数据包的传输和接收设计。网络驱动程序对单个连接一无所知；它只处理数据包。由于网络接口不是面向流的设备，因此不容易像/dev/tty1那样映射到文件系统中的节点。Unix提供对接口访问的方式仍然是为它们分配唯一的名称（如eth0），但该名称在文件系统中没有相应的条目。内核与网络设备驱动程序之间的通信与字符和块驱动程序完全不同。内核调用与数据包传输相关的函数，而不是read和write。

还有其他与上述设备类型正交的驱动程序模块分类方式。一般来说，某些类型的驱动程序与给定类型设备的额外内核支持功能层一起工作。例如，可以谈论通用串行总线（USB）模块、串行模块、SCSI模块等。每个USB设备都由一个与USB子系统一起工作的USB模块驱动，但设备本身在系统中显示为字符设备（如USB串行端口）、块设备（如USB存储卡读卡器）或网络设备（如USB以太网接口）。

近年来，内核中添加了其他类别的设备驱动程序，包括FireWire驱动程序和I2O驱动程序。与处理USB和SCSI驱动程序的方式相同，内核开发人员收集了类范围内的功能，并将其导出给驱动程序实现者，以避免重复工作和错误，从而简化和加强编写此类驱动程序的过程。

除了设备驱动程序外，内核中还模块化了其他功能，包括硬件和软件。一个常见的例子是文件系统。文件系统类型决定了如何在块设备上组织信息以表示目录和文件的树。这种实体不是设备驱动程序，因为没有显式设备与信息的布局方式相关联；文件系统类型是软件驱动程序，因为它将低级数据结构映射到高级数据结构。文件系统决定了文件名可以有多长以及每个文件的信息存储在目录条目中的内容。文件系统模块必须实现访问目录和文件的系统调用的最低级别，通过将文件名和路径（以及其他信息，如访问模式）映射到存储在数据块中的数据结构。这种接口与实际数据传输到磁盘（或其他介质）完全独立，后者由块设备驱动程序完成。

如果你考虑到Unix系统对底层文件系统的依赖程度，你会意识到这种软件概念对系统操作至关重要。解码文件系统信息的能力位于内核层次结构的最低层，至关重要；即使你为新的CD-ROM编写了块驱动程序，如果你无法对其托管的数据运行ls或cp，它也是无用的。Linux支持文件系统模块的概念，其软件接口声明了可以对文件系统节点、目录、文件和超级块执行的不同操作。程序员通常不需要编写文件系统模块，因为官方内核已经包含了最重要文件系统类型的代码。

