# 准备工作

我们即将查看一些实际的模块代码。但首先，我们需要查看一些其他需要在模块源文件中出现的内容。内核是一个独特的环境，它对与其交互的代码提出了自己的要求。

大多数内核代码最终会包含相当多的头文件，以获取函数、数据类型和变量的定义。我们将在遇到这些文件时进行讨论，但有一些特定于模块的文件，必须出现在每个可加载模块中。因此，几乎所有模块代码都有以下内容：

```c
#include <linux/module.h>
#include <linux/init.h>
```

`module.h` 包含许多可加载模块所需的符号和函数的定义。你需要 `init.h` 来指定初始化和清理函数，正如我们在“hello world”示例中看到的那样，我们将在下一节中重新讨论。大多数模块还包括 `moduleparam.h`，以便在加载时向模块传递参数；我们稍后会讨论这一点。

虽然不是严格必要的，但你的模块确实应该指定适用于其代码的许可证。只需包含一行 `MODULE_LICENSE` 即可：

```c
MODULE_LICENSE("GPL");
```

内核识别的特定许可证包括“GPL”（适用于任何版本的 GNU 通用公共许可证）、“GPL v2”（仅适用于 GPL 第二版）、“GPL 及附加权利”、“Dual BSD/GPL”、“Dual MPL/GPL”和“Proprietary”。除非你的模块明确标记为内核认可的自由许可证，否则它被视为专有模块，加载模块时内核会被“污染”。正如我们在第1章的“许可条款”部分提到的，内核开发者通常对帮助加载专有模块后遇到问题的用户不太热心。

其他可以包含在模块中的描述性定义包括 `MODULE_AUTHOR`（声明谁编写了模块）、`MODULE_DESCRIPTION`（模块功能的可读描述）、`MODULE_VERSION`（代码修订号；请参阅 `<linux/module.h>` 中的注释以了解创建版本字符串的约定）、`MODULE_ALIAS`（模块的另一个名称）和 `MODULE_DEVICE_TABLE`（告诉用户空间模块支持哪些设备）。我们将在第11章讨论 `MODULE_ALIAS`，在第12章讨论 `MODULE_DEVICE_TABLE`。

各种 `MODULE_` 声明可以出现在源文件中函数之外的任何位置。然而，内核代码中相对较新的约定是将这些声明放在文件末尾。
