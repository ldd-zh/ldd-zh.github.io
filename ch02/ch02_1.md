# 设置测试系统

从本章开始，我们将通过示例模块来演示编程概念。（所有这些示例都可以在O’Reilly的FTP站点上找到，详见第1章。）构建、加载和修改这些示例是理解驱动程序如何工作以及与内核交互的好方法。

这些示例模块应该适用于几乎所有2.6.x内核，包括由发行版供应商提供的内核。然而，我们建议你直接从kernel.org镜像网络获取“主线”内核，并将其安装到你的系统上。供应商的内核可能经过大量补丁修改，与主线内核存在差异；有时，供应商的补丁可能会改变设备驱动程序所看到的内核API。如果你正在编写一个必须在特定发行版上运行的驱动程序，你肯定需要针对相关内核进行构建和测试。但是，出于学习驱动程序编写的目的，标准内核是最佳选择。

无论你的内核来源如何，构建2.6.x模块都要求你在系统上有一个配置并构建好的内核树。这一要求与之前的内核版本不同，以前只需要一组当前的头文件即可。2.6模块是链接到内核源代码树中的目标文件的；这使得模块加载器更加健壮，但也要求这些目标文件必须可用。因此，你的首要任务是获取一个内核源代码树（可以从kernel.org网络或你的发行版的内核源代码包中获取），构建一个新内核，并将其安装到你的系统上。出于我们稍后会看到的原因，通常最简单的情况是你在构建模块时实际运行目标内核，尽管这并不是必须的。

你还应该考虑在哪里进行模块的实验、开发和测试。我们已尽力确保示例模块的安全性和正确性，但错误的可能性始终存在。内核代码中的故障可能会导致用户进程甚至整个系统的崩溃。它们通常不会引发更严重的问题，例如磁盘损坏。尽管如此，建议你在不包含重要数据的系统上进行内核实验，并且该系统不应执行关键服务。内核黑客通常会保留一个“牺牲”系统用于测试新代码。

因此，如果你还没有一个配置并构建好内核源代码树的合适系统，现在是时候设置一个了。我们会等你。一旦完成这个任务，你就可以开始玩转内核模块了。
