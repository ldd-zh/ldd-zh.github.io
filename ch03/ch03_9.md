# 快速参考

本章介绍了以下符号和头文件。struct file_operations 和 struct file 的字段列表在此不再重复。

- `#include <linux/types.h>`
- `dev_t`
    dev_t 是内核中用于表示设备号的类型。
- `int MAJOR(dev_t dev)`
- `int MINOR(dev_t dev)`
    从设备号中提取主设备号和次设备号的宏。
- `dev_t MKDEV(unsigned int major, unsigned int minor)`
    从主设备号和次设备号构建 dev_t 数据项的宏。
- `#include <linux/fs.h>`
    “文件系统”头文件是编写设备驱动所需的头文件。许多重要的函数和数据结构在此声明。
- `int register_chrdev_region(dev_t first, unsigned int count, char *name)`
- `int alloc_chrdev_region(dev_t *dev, unsigned int firstminor, unsigned int count, char *name)`
- `void unregister_chrdev_region(dev_t first, unsigned int count)`
    允许驱动分配和释放设备号范围的函数。register_chrdev_region 应在提前知道所需主设备号时使用；对于动态分配，请改用 alloc_chrdev_region。
- `int register_chrdev(unsigned int major, const char *name, struct file_operations *fops)`
    旧的（2.6 之前）字符设备注册例程。它在 2.6 内核中被模拟，但不应在新代码中使用。如果主设备号不为 0，则它被原样使用；否则，为此设备分配一个动态号码。
- `int unregister_chrdev(unsigned int major, const char *name)`
    撤销 register_chrdev 所做的注册的函数。major 和 name 字符串必须包含用于注册驱动的相同值。
- `struct file_operations`
- `struct file`
- `struct inode`
    大多数设备驱动使用的三个重要数据结构。file_operations 结构保存字符驱动的方法；struct file 表示一个打开的文件，struct inode 表示磁盘上的文件。
- `#include <linux/cdev.h>`
- `struct cdev *cdev_alloc(void)`
- `void cdev_init(struct cdev *dev, struct file_operations *fops)`
- `int cdev_add(struct cdev *dev, dev_t num, unsigned int count)`
- `void cdev_del(struct cdev *dev)`
    用于管理 cdev 结构的函数，cdev 结构表示内核中的字符设备。
- `#include <linux/kernel.h>`
- `container_of(pointer, type, field)`
    一个方便的宏，可用于从指向包含在其中的某个结构的指针获取指向该结构的指针。
- `#include <asm/uaccess.h>`
    此头文件声明了内核代码用于在用户空间和内核空间之间移动数据的函数。
- `unsigned long copy_from_user (void *to, const void *from, unsigned long count)`
- `unsigned long copy_to_user (void *to, const void *from, unsigned long count)`
    在用户空间和内核空间之间复制数据。
