<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using https://github.com/wa-lang/wabook -->
        <meta charset="UTF-8">
        <title>设备和模块的分类 - linux设备驱动</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../static/wabook/css/variables.css">
        <link rel="stylesheet" href="../static/wabook/css/general.css">
        <link rel="stylesheet" href="../static/wabook/css/chrome.css">
        <link rel="stylesheet" href="../static/wabook/css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../static/wabook/FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../static/wabook/fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../static/wabook/highlight.css">
        <link rel="stylesheet" href="../static/wabook/tomorrow-night.css">
        <link rel="stylesheet" href="../static/wabook/ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('wabook-theme');
                var sidebar = localStorage.getItem('wabook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('wabook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('wabook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('wabook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('wabook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter">
  <li class="chapter-item expanded ">
    <a href="../index.html" >linux设备驱动</a>
  </li>
  <li class="chapter-item expanded ">
    <a href="../preface.html" >前言</a>
  </li>
  <li class="chapter-item expanded ">
    <a href="../ch1/chapter_1.html" ><strong aria-hidden="true">1.</strong> 设备驱动简介</a>
  </li>
  <ol class="section">
    <li class="chapter-item expanded ">
      <a href="../ch1/chapter_1.1.html" ><strong aria-hidden="true">1.1.</strong> 设备驱动的角色</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch1/chapter_1.2.html" ><strong aria-hidden="true">1.2.</strong> 内核的划分</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch1/chapter_1.3.html" class="active"><strong aria-hidden="true">1.3.</strong> 设备和模块的分类</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch1/chapter_1.4.html" ><strong aria-hidden="true">1.4.</strong> 安全问题</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch1/chapter_1.5.html" ><strong aria-hidden="true">1.5.</strong> 版本编号</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch1/chapter_1.6.html" ><strong aria-hidden="true">1.6.</strong> 许可条款</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch1/chapter_1.7.html" ><strong aria-hidden="true">1.7.</strong> 加入内核开发社区</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch1/chapter_1.8.html" ><strong aria-hidden="true">1.8.</strong> 本书概述</a>
    </li>
  </ol>
  <li class="chapter-item expanded ">
    <a href="../ch2/chapter_2.html" ><strong aria-hidden="true">2.</strong> 构建和运行模块</a>
  </li>
  <ol class="section">
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.1.html" ><strong aria-hidden="true">2.1.</strong> 配置测试系统</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.2.html" ><strong aria-hidden="true">2.2.</strong> Hello World模块</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.3.html" ><strong aria-hidden="true">2.3.</strong> 内核模块与应用程序的对比</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.4.html" ><strong aria-hidden="true">2.4.</strong> 编译与加载</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.5.html" ><strong aria-hidden="true">2.5.</strong> 内核符号表</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.6.html" ><strong aria-hidden="true">2.6.</strong> 基础准备工作</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.7.html" ><strong aria-hidden="true">2.7.</strong> 初始化与关闭</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.8.html" ><strong aria-hidden="true">2.8.</strong> 模块参数</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.9.html" ><strong aria-hidden="true">2.9.</strong> 用户空间编程</a>
    </li>
    <li class="chapter-item expanded ">
      <a href="../ch2/chapter_2.10.html" ><strong aria-hidden="true">2.10.</strong> 快速参考</a>
    </li>
  </ol>
</ol>

            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title"><a href="../index.html">linux设备驱动</a></h1>

                    <div class="right-buttons">
                        <a href="https://github.com/ldd-zh/ldd-zh.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ldd-zh/ldd-zh.github.io/edit/master/testdata/ch1/chapter_1.3.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <!-- Page table of contents -->
                    <div class="sidetoc"><nav class="pagetoc"></nav></div>

                    <main>
                        

                        <h1>设备和模块的分类</h1>
<p>Linux 对设备的分类区分了三种基本的设备类型。每个模块通常实现其中的一种类型，因此可以将其归类为字符设备模块、块设备模块或网络设备模块。这种模块的分类并不是严格的；程序员可以选择将不同的驱动程序实现成一个大模块。然而，优秀的程序员通常会为每个新实现的功能创建一个不同的模块，因为模块化是可扩展性和可伸缩性的关键因素。</p>
<p>这三类设备是:</p>
<ul>
<li>
<p>字符设备</p>
<p>字符设备（char设备）是指可以作为字节流进行访问的设备（类似于文件）；字符设备驱动程序负责实现这种行为。这样的驱动程序通常至少实现 <code>open</code>、<code>close</code>、<code>read</code> 和 <code>write</code> 系统调用。文本控制台（/dev/console）和串口（/dev/ttyS0 等）就是字符设备的例子，因为它们很适合用流的抽象来表示。字符设备通过文件系统节点进行访问，例如 /dev/tty1 和 /dev/lp0。</p>
<p>字符设备和常规文件之间的唯一区别在于，常规文件可以随意地在文件内部前后移动，而大多数字符设备只是数据通道，只能按顺序访问。然而，也存在一些看起来像数据区域的字符设备，用户可以在其中前后移动；例如，这通常适用于帧捕捉设备，应用程序可以使用 <code>mmap</code> 或 <code>lseek</code> 来访问整个获取的图像。</p>
</li>
<li>
<p>块设备</p>
<p>与字符设备类似，块设备也通过 /dev 目录中的文件系统节点进行访问。块设备是指可以承载文件系统的设备（例如磁盘）。在大多数 Unix 系统中，块设备只能处理一次传输一个或多个完整的块操作，这些块通常是 512 字节（或更大的 2 的幂次方）长度。然而，Linux 允许应用程序像访问字符设备一样读取和写入块设备——它允许一次传输任意数量的字节。因此，块设备和字符设备的区别仅在于内核内部数据的管理方式，因此也体现在内核/驱动程序的软件接口上。像字符设备一样，每个块设备通过文件系统节点进行访问，但它们之间的差异对用户是透明的。块设备驱动程序与字符设备驱动程序的接口完全不同。</p>
</li>
<li>
<p>网络接口</p>
<p>任何网络事务都通过一个接口进行，也就是一个能够与其他主机交换数据的设备。通常，这个接口是硬件设备，但也可能是一个纯软件设备，比如回环接口（loopback interface）。网络接口负责发送和接收数据包，由内核的网络子系统驱动，而不需要知道单个事务如何映射到实际的传输数据包。许多网络连接（尤其是使用 TCP 的连接）是面向流的，但网络设备通常是围绕数据包的传输和接收设计的。网络驱动程序对个别连接一无所知，它只处理数据包。</p>
<p>由于网络接口不是面向流的设备，因此不容易像 /dev/tty1 那样映射到文件系统中的节点。Unix 提供对接口的访问方式是为其分配一个唯一的名称（例如 eth0），但这个名称在文件系统中没有对应的条目。内核与网络设备驱动程序之间的通信与字符设备和块设备驱动程序的通信方式完全不同。内核不使用 <code>read</code> 和 <code>write</code>，而是调用与数据包传输相关的函数。</p>
</li>
</ul>
<p>除了上述的设备类型分类外，还有其他方式对驱动模块进行分类，这些分类与设备类型是正交的。一般来说，某些类型的驱动程序需要与内核支持的额外功能层配合使用，以支持特定类型的设备。例如，可以提到通用串行总线（USB）模块、串口模块、SCSI 模块等。每个 USB 设备都由一个 USB 模块驱动，该模块与 USB 子系统协作，但设备本身在系统中可能表现为字符设备（例如 USB 串口）、块设备（例如 USB 存储卡读卡器）或网络设备（例如 USB 以太网接口）。</p>
<p>近年来，内核中还新增了其他类别的设备驱动程序，包括 FireWire 驱动程序和 I2C 驱动程序。和处理 USB 和 SCSI 驱动程序一样，内核开发者将各类通用功能收集起来，并将其导出给驱动程序实现者，以避免重复工作和错误，从而简化并强化了编写此类驱动程序的过程。</p>
<p>除了设备驱动程序，内核中还有其他硬件和软件功能被模块化。一个常见的例子是文件系统。文件系统类型决定了如何在块设备上组织信息，以便表示一个目录和文件的树状结构。这样的实体并不是一个设备驱动程序，因为没有明确的设备与信息的存储方式相关联；文件系统类型实际上是一个软件驱动程序，因为它将低级数据结构映射到高级数据结构。正是文件系统决定了文件名的最大长度以及每个文件在目录项中存储的相关信息。</p>
<p>文件系统模块必须实现访问目录和文件的系统调用的最低层次，通过将文件名和路径（以及其他信息，如访问模式）映射到存储在数据块中的数据结构。这样的接口与实际的数据传输（例如从磁盘或其他介质）是完全独立的，数据传输是由块设备驱动程序来完成的。</p>
<p>如果你考虑到 Unix 系统是多么依赖底层的文件系统，你会意识到这样一个软件概念对于系统操作是至关重要的。解码文件系统信息的能力位于内核层次结构的最底层，并且极其重要；即使你为新的 CD-ROM 写了一个块设备驱动程序，如果你不能在其上运行 ls 或 cp 命令，它也是无用的。Linux 支持文件系统模块的概念，其软件接口声明了可以对文件系统的 inode、目录、文件和超级块执行的不同操作。实际上，程序员通常不需要编写文件系统模块，因为官方内核已经包含了最重要的文件系统类型的代码。</p>


                        

                        

                        
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../ch1/chapter_1.2.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                        
                            <!-- ../ch1/chapter_1.4.html -->
                            <a rel="next" href="../ch1/chapter_1.4.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../ch1/chapter_1.2.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                
                    <a rel="next" href="../ch1/chapter_1.4.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../static/wabook/mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../static/wabook/clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../static/wabook/highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../static/wabook/book.js" type="text/javascript" charset="utf-8"></script>
        
        <script type="text/javascript" charset="utf-8">
            var pagePath = "ch1/chapter_1.3.md"
        </script>

        <!-- Custom JS scripts -->
        

    </body>
</html>
